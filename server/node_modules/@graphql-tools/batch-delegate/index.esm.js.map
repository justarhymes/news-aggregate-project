{"version":3,"file":"index.esm.js","sources":["../../../dist/batch-delegate/src/createBatchDelegateFn.js"],"sourcesContent":["import { getNamedType, GraphQLList } from 'graphql';\nimport DataLoader from 'dataloader';\nimport { delegateToSchema } from '@graphql-tools/delegate';\nexport function createBatchDelegateFn(argFn, batchDelegateOptionsFn, dataLoaderOptions) {\n    let cache;\n    function createBatchFn(options) {\n        return async (keys) => {\n            const results = await delegateToSchema({\n                returnType: new GraphQLList(getNamedType(options.info.returnType)),\n                args: argFn(keys),\n                ...batchDelegateOptionsFn(options),\n            });\n            return Array.isArray(results) ? results : keys.map(() => results);\n        };\n    }\n    function getLoader(options) {\n        if (!cache) {\n            cache = new WeakMap();\n            const batchFn = createBatchFn(options);\n            const newValue = new DataLoader(keys => batchFn(keys), dataLoaderOptions);\n            cache.set(options.info.fieldNodes, newValue);\n            return newValue;\n        }\n        const cachedValue = cache.get(options.info.fieldNodes);\n        if (cachedValue === undefined) {\n            const batchFn = createBatchFn(options);\n            const newValue = new DataLoader(keys => batchFn(keys), dataLoaderOptions);\n            cache.set(options.info.fieldNodes, newValue);\n            return newValue;\n        }\n        return cachedValue;\n    }\n    return options => {\n        const loader = getLoader(options);\n        return loader.load(options.key);\n    };\n}\n//# sourceMappingURL=createBatchDelegateFn.js.map"],"names":[],"mappings":";;;;AAGO,SAAS,qBAAqB,CAAC,KAAK,EAAE,sBAAsB,EAAE,iBAAiB,EAAE;AACxF,IAAI,IAAI,KAAK,CAAC;AACd,IAAI,SAAS,aAAa,CAAC,OAAO,EAAE;AACpC,QAAQ,OAAO,OAAO,IAAI,KAAK;AAC/B,YAAY,MAAM,OAAO,GAAG,MAAM,gBAAgB,CAAC;AACnD,gBAAgB,UAAU,EAAE,IAAI,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAClF,gBAAgB,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC;AACjC,gBAAgB,GAAG,sBAAsB,CAAC,OAAO,CAAC;AAClD,aAAa,CAAC,CAAC;AACf,YAAY,OAAO,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,OAAO,CAAC,CAAC;AAC9E,SAAS,CAAC;AACV,KAAK;AACL,IAAI,SAAS,SAAS,CAAC,OAAO,EAAE;AAChC,QAAQ,IAAI,CAAC,KAAK,EAAE;AACpB,YAAY,KAAK,GAAG,IAAI,OAAO,EAAE,CAAC;AAClC,YAAY,MAAM,OAAO,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC;AACnD,YAAY,MAAM,QAAQ,GAAG,IAAI,UAAU,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE,iBAAiB,CAAC,CAAC;AACtF,YAAY,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AACzD,YAAY,OAAO,QAAQ,CAAC;AAC5B,SAAS;AACT,QAAQ,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC/D,QAAQ,IAAI,WAAW,KAAK,SAAS,EAAE;AACvC,YAAY,MAAM,OAAO,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC;AACnD,YAAY,MAAM,QAAQ,GAAG,IAAI,UAAU,CAAC,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,EAAE,iBAAiB,CAAC,CAAC;AACtF,YAAY,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;AACzD,YAAY,OAAO,QAAQ,CAAC;AAC5B,SAAS;AACT,QAAQ,OAAO,WAAW,CAAC;AAC3B,KAAK;AACL,IAAI,OAAO,OAAO,IAAI;AACtB,QAAQ,MAAM,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC;AAC1C,QAAQ,OAAO,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;AACxC,KAAK,CAAC;AACN;;;;"}